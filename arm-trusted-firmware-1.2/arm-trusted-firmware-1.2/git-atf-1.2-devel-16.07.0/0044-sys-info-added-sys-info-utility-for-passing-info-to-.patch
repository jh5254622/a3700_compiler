From 645a8d08cdaafa42fe27dd32e951a29347d6286c Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Wed, 9 Mar 2016 14:47:39 +0200
Subject: [PATCH 044/239] sys-info: added sys-info utility for passing info to
 bootloader

Change-Id: Ib8e561f44e4cf3626189938dcbbe048885904102
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/28145
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Haim Boot <hayim@marvell.com>
---
 include/plat/marvell/common/sys_info.h | 63 ++++++++++++++++++++++++++++++++++
 plat/marvell/common/sys_info.c         | 52 ++++++++++++++++++++++++++++
 2 files changed, 115 insertions(+)
 create mode 100644 include/plat/marvell/common/sys_info.h
 create mode 100644 plat/marvell/common/sys_info.c

diff --git a/include/plat/marvell/common/sys_info.h b/include/plat/marvell/common/sys_info.h
new file mode 100644
index 0000000..3efc7ae
--- /dev/null
+++ b/include/plat/marvell/common/sys_info.h
@@ -0,0 +1,63 @@
+/*
+* ***************************************************************************
+* Copyright (C) 2016 Marvell International Ltd.
+* ***************************************************************************
+*
+* Redistribution and use in source and binary forms, with or without
+* modification, are permitted provided that the following conditions are met:
+*
+* Redistributions of source code must retain the above copyright notice, this
+* list of conditions and the following disclaimer.
+*
+* Redistributions in binary form must reproduce the above copyright notice,
+* this list of conditions and the following disclaimer in the documentation
+* and/or other materials provided with the distribution.
+*
+* Neither the name of Marvell nor the names of its contributors may be used
+* to endorse or promote products derived from this software without specific
+* prior written permission.
+*
+* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
+* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+* ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
+* LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+* OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+* SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+* INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+* CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+* POSSIBILITY OF SUCH DAMAGE.
+*
+***************************************************************************
+*/
+
+#ifndef _SYS_INFO_H_
+#define _SYS_INFO_H_
+
+#define SYSTEM_INFO_ADDRESS	0x4000000
+
+enum sys_info_type {
+	ARRAY_SIZE,
+	DRAM_CS0_SIZE,
+	DRAM_CS1_SIZE,
+	DRAM_CS2_SIZE,
+	DRAM_CS3_SIZE,
+	DRAM_BUS_WIDTH,
+	DRAM_ECC,
+	DRAM_CS0,
+	DRAM_CS1,
+	DRAM_CS2,
+	DRAM_CS3,
+	RECOVERY_MODE,
+	MAX_OPTION,
+};
+
+struct sys_info {
+	enum sys_info_type field_id;
+	uint32_t value;
+};
+
+void set_info(enum sys_info_type field, uint32_t value);
+
+#endif /* _SYS_INFO_H_ */
diff --git a/plat/marvell/common/sys_info.c b/plat/marvell/common/sys_info.c
new file mode 100644
index 0000000..e695901
--- /dev/null
+++ b/plat/marvell/common/sys_info.c
@@ -0,0 +1,52 @@
+/*
+* ***************************************************************************
+* Copyright (C) 2016 Marvell International Ltd.
+* ***************************************************************************
+*
+* Redistribution and use in source and binary forms, with or without
+* modification, are permitted provided that the following conditions are met:
+*
+* Redistributions of source code must retain the above copyright notice, this
+* list of conditions and the following disclaimer.
+*
+* Redistributions in binary form must reproduce the above copyright notice,
+* this list of conditions and the following disclaimer in the documentation
+* and/or other materials provided with the distribution.
+*
+* Neither the name of Marvell nor the names of its contributors may be used
+* to endorse or promote products derived from this software without specific
+* prior written permission.
+*
+* THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
+* AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
+* IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
+* ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
+* LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY,
+* OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
+* SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
+* INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
+* CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
+* ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
+* POSSIBILITY OF SUCH DAMAGE.
+*
+***************************************************************************
+*/
+
+#include <arch_helpers.h>
+#include <plat_marvell.h>
+#include <debug.h>
+#include <sys_info.h>
+
+struct sys_info *sys_info_in_ptr = (struct sys_info *)SYSTEM_INFO_ADDRESS;
+/* skip index 0 because this index in dedicated to array system-info size*/
+int sys_info_size = 1;
+
+void set_info(enum sys_info_type field, unsigned int value)
+{
+	if (sys_info_size == 1)
+		sys_info_in_ptr[ARRAY_SIZE].field_id = ARRAY_SIZE;
+	sys_info_in_ptr[sys_info_size].field_id = field;
+	sys_info_in_ptr[sys_info_size].value = value;
+	sys_info_in_ptr[ARRAY_SIZE].value = ++sys_info_size;
+}
+
-- 
1.9.1

