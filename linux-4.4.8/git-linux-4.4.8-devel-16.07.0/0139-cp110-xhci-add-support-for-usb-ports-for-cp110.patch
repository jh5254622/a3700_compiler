From e7628bec2b2ef079b1a2cc2979f39f7ebf0e3343 Mon Sep 17 00:00:00 2001
From: Yehuda Yitschak <yehuday@marvell.com>
Date: Sun, 21 Feb 2016 13:13:47 +0200
Subject: [PATCH 139/538] cp110: xhci: add support for usb ports for cp110

- add basic xhci-plat entries to cp110 dtsi file
- enabled the relevant usb ports in armada-7040 board setups
- enable mvebu xhci plat driver

Change-Id: Ie49ada91c572a4045422b0f9cf83c5a8e7a6df0b
Signed-off-by: Yehuda Yitschak <yehuday@marvell.com>
---
 arch/arm64/boot/dts/marvell/armada-7040-rz-db-nand.dts |  6 ++++++
 .../boot/dts/marvell/armada-7040-rz-db-router.dts      |  6 ++++++
 arch/arm64/boot/dts/marvell/armada-cp110.dtsi          | 18 ++++++++++++++++++
 arch/arm64/configs/mvebu_v8_lsp_defconfig              |  2 +-
 4 files changed, 31 insertions(+), 1 deletion(-)

diff --git a/arch/arm64/boot/dts/marvell/armada-7040-rz-db-nand.dts b/arch/arm64/boot/dts/marvell/armada-7040-rz-db-nand.dts
index 544b303..29d8222 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-rz-db-nand.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-rz-db-nand.dts
@@ -60,6 +60,12 @@
 			sata: sata@540000 {
 				status = "okay";
 			};
+			usb3h0: usb3@500000 {
+				status = "okay";
+			};
+			usb3h1: usb3@510000 {
+				status = "okay";
+			};
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-7040-rz-db-router.dts b/arch/arm64/boot/dts/marvell/armada-7040-rz-db-router.dts
index 74e75d0..dab592b 100644
--- a/arch/arm64/boot/dts/marvell/armada-7040-rz-db-router.dts
+++ b/arch/arm64/boot/dts/marvell/armada-7040-rz-db-router.dts
@@ -60,6 +60,12 @@
 			sata: sata@540000 {
 				status = "okay";
 			};
+			usb3h0: usb3@500000 {
+				status = "okay";
+			};
+			usb3h1: usb3@510000 {
+				status = "okay";
+			};
 		};
 	};
 };
diff --git a/arch/arm64/boot/dts/marvell/armada-cp110.dtsi b/arch/arm64/boot/dts/marvell/armada-cp110.dtsi
index 12acaf7..bbb1fab 100644
--- a/arch/arm64/boot/dts/marvell/armada-cp110.dtsi
+++ b/arch/arm64/boot/dts/marvell/armada-cp110.dtsi
@@ -39,3 +39,21 @@ sata: sata@540000 {
 	port_base = <0x10000>;
 	port_offset = <0x10000>;
 };
+
+usb3h0: usb3@500000 {
+	compatible = "generic-xhci";
+	reg = <0x500000 0x4000>;
+	dma-coherent;
+	interrupts = <GIC_SPI 62 IRQ_TYPE_LEVEL_HIGH>;
+	clocks = <&gateclk 22>, <&gateclk 16>;
+	status = "disabled";
+};
+
+usb3h1: usb3@510000 {
+	compatible = "generic-xhci";
+	reg = <0x510000 0x4000>;
+	dma-coherent;
+	interrupts = <GIC_SPI 61 IRQ_TYPE_LEVEL_HIGH>;
+	clocks = <&gateclk 23>, <&gateclk 16>;
+	status = "disabled";
+};
diff --git a/arch/arm64/configs/mvebu_v8_lsp_defconfig b/arch/arm64/configs/mvebu_v8_lsp_defconfig
index 24d4bc3..7464e41 100644
--- a/arch/arm64/configs/mvebu_v8_lsp_defconfig
+++ b/arch/arm64/configs/mvebu_v8_lsp_defconfig
@@ -127,7 +127,7 @@ CONFIG_LOGO=y
 # CONFIG_LOGO_LINUX_VGA16 is not set
 CONFIG_USB=y
 CONFIG_USB_XHCI_HCD=y
-CONFIG_USB_XHCI_PLATFORM=y
+CONFIG_USB_XHCI_MVEBU=y
 CONFIG_USB_EHCI_HCD=y
 CONFIG_USB_EHCI_HCD_PLATFORM=y
 CONFIG_USB_OHCI_HCD=y
-- 
1.9.1

