From 57befcbcdfe7dc7d3e296a5e9044c4124ecacc0a Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Tue, 14 Jul 2015 15:01:29 +0300
Subject: [PATCH 0250/1240] spl: comphy: integrate COMPHY into SPL

Change-Id: Ia45ea393a3be004e6ad4136e3b99a94cedeadb32
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/21272
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
---
 arch/arm/cpu/mvebu-common/spl.c | 7 ++++++-
 scripts/Makefile.spl            | 1 +
 2 files changed, 7 insertions(+), 1 deletion(-)

diff --git a/arch/arm/cpu/mvebu-common/spl.c b/arch/arm/cpu/mvebu-common/spl.c
index 21f8b69..edd62e1 100644
--- a/arch/arm/cpu/mvebu-common/spl.c
+++ b/arch/arm/cpu/mvebu-common/spl.c
@@ -20,6 +20,7 @@
 #include <spl.h>
 #include <fdtdec.h>
 #include <asm/arch-mvebu/fdt.h>
+#include <asm/arch-mvebu/comphy.h>
 
 DECLARE_GLOBAL_DATA_PTR;
 
@@ -47,8 +48,12 @@ void board_init_f(ulong silent)
 		gd->flags |= GD_FLG_SILENT;
 
 	setup_fdt();
+	preloader_console_init();
+#if CONFIG_MVEBU_COMPHY_SUPPORT
+	if (comphy_init(gd->fdt_blob))
+		error("COMPHY initialization failed\n");
+#endif
 #ifndef CONFIG_PALLADIUM
 	static_dram_init();
 #endif
-	preloader_console_init();
 }
diff --git a/scripts/Makefile.spl b/scripts/Makefile.spl
index 3c5c397..3ac9155 100644
--- a/scripts/Makefile.spl
+++ b/scripts/Makefile.spl
@@ -80,6 +80,7 @@ libs-$(CONFIG_SPL_USB_HOST_SUPPORT) += drivers/usb/host/
 libs-$(CONFIG_OMAP_USB_PHY) += drivers/usb/phy/
 libs-$(CONFIG_SPL_SATA_SUPPORT) += drivers/block/
 libs-$(CONFIG_MVEBU_SPL_DDR_SUPPORT) += drivers/ddr/
+libs-$(CONFIG_MVEBU_COMPHY_SUPPORT) += drivers/phy/
 libs-$(CONFIG_OF_EMBED) += dts/
 
 head-y		:= $(addprefix $(obj)/,$(head-y))
-- 
1.9.1

