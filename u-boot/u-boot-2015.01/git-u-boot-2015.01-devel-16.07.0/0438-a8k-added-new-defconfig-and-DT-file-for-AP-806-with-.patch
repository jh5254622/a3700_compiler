From 09cb95cc337356b809d3bb3f3f8b3d14ad88ebda Mon Sep 17 00:00:00 2001
From: Hanna Hawa <hannah@marvell.com>
Date: Thu, 15 Oct 2015 18:18:04 +0300
Subject: [PATCH 0438/1240] a8k: added new defconfig and DT file for AP-806
 with DRAM over PCIe

Change-Id: I05ce62e09eaafba01ef36be77a928e2130b08e5e
Signed-off-by: Hanna Hawa <hannah@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/24032
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Yehuda Yitschak <yehuday@marvell.com>
---
 arch/arm/dts/Makefile              |  7 ++++---
 arch/arm/dts/apn-806-db-dop.dts    | 34 ++++++++++++++++++++++++++++++++++
 configs/mvebu_apn806_dop_defconfig | 38 ++++++++++++++++++++++++++++++++++++++
 3 files changed, 76 insertions(+), 3 deletions(-)
 create mode 100644 arch/arm/dts/apn-806-db-dop.dts
 create mode 100644 configs/mvebu_apn806_dop_defconfig

diff --git a/arch/arm/dts/Makefile b/arch/arm/dts/Makefile
index 918573b..41e37a1 100644
--- a/arch/arm/dts/Makefile
+++ b/arch/arm/dts/Makefile
@@ -54,9 +54,10 @@ dtb-$(CONFIG_SOCFPGA) += socfpga_cyclone5_socrates.dtb
 dtb-$(CONFIG_MVEBU) += armada-385-db.dtb
 dtb-$(CONFIG_MVEBU) += armada-lp-db.dtb
 dtb-$(CONFIG_MVEBU) += armada-lp-palladium.dtb
-dtb-$(CONFIG_MVEBU) += apn-806-db.dtb
-dtb-$(CONFIG_MVEBU) += apn-806-pd.dtb
-dtb-$(CONFIG_MVEBU) += apn-806-db-flc.dtb
+dtb-$(CONFIG_MVEBU) += apn-806-db.dtb \
+		       apn-806-pd.dtb \
+		       apn-806-db-flc.dtb \
+		       apn-806-db-dop.dtb
 
 targets += $(dtb-y)
 
diff --git a/arch/arm/dts/apn-806-db-dop.dts b/arch/arm/dts/apn-806-db-dop.dts
new file mode 100644
index 0000000..0ce9ff7
--- /dev/null
+++ b/arch/arm/dts/apn-806-db-dop.dts
@@ -0,0 +1,34 @@
+/*
+ * ***************************************************************************
+ * Copyright (C) 2015 Marvell International Ltd.
+ * ***************************************************************************
+ * This program is free software: you can redistribute it and/or modify it
+ * under the terms of the GNU General Public License as published by the Free
+ * Software Foundation, either version 2 of the License, or any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program.  If not, see <http://www.gnu.org/licenses/>.
+ * ***************************************************************************
+ */
+
+/dts-v1/;
+
+/* This Device tree used for AP-806 with DRAM over PCIe */
+#include "apn-806-db.dtsi"
+
+/{
+	soc {
+		pcie-controller {
+			pcie@1,0 {
+				reg = <0x50000000 0x2000>;
+				mem = <0x40000000 0x40000000>;
+				status = "okay";
+			};
+		};
+	};
+};
diff --git a/configs/mvebu_apn806_dop_defconfig b/configs/mvebu_apn806_dop_defconfig
new file mode 100644
index 0000000..b5de79d
--- /dev/null
+++ b/configs/mvebu_apn806_dop_defconfig
@@ -0,0 +1,38 @@
+CONFIG_SPL=y
+CONFIG_SYS_EXTRA_OPTIONS="ARM64"
++S:CONFIG_ARM=y
++S:CONFIG_TARGET_ARMADA_8K=y
+# CONFIG_PALLADIUM is not set
+CONFIG_MVEBU_SPI=y
+CONFIG_MVEBU_MPP_BUS=y
+CONFIG_MVEBU_I2C=y
++S:CONFIG_MVEBU_SPL_DDR_OVER_PCI_SUPPORT=y
++S:CONFIG_MVEBU_SPL_SAR_DUMP=y
++S:CONFIG_DEVEL_BOARD=y
+CONFIG_CUSTOMER_BOARD=y
+CONFIG_CMD_BOOTD=y
+CONFIG_CMD_RUN=y
+CONFIG_CMD_EDITENV=y
+CONFIG_CMD_SAVEENV=y
+CONFIG_CMD_MEMORY=y
+CONFIG_CMD_MEMTEST=y
+CONFIG_CMD_I2C=y
+CONFIG_CMD_NET=y
+CONFIG_CMD_PING=y
+CONFIG_CMD_TIME=y
+CONFIG_CMD_MISC=y
+CONFIG_CMD_TIMER=y
+CONFIG_CMD_MVEBU_SAR=y
+CONFIG_CMD_MVEBU_MPP=y
+CONFIG_CMD_MVEBU_BUBT=y
+CONFIG_CMD_MVEBU_TSEN=y
++S:CONFIG_OF_CONTROL=y
++S:CONFIG_OF_EMBED=y
++S:CONFIG_DEFAULT_DEVICE_TREE="apn-806-db"
+CONFIG_ENC28J60=y
++S:CONFIG_SYS_NS16550=y
+CONFIG_MVEBU_PINCTL=y
++S:CONFIG_MVEBU_COMPHY_SUPPORT=y
++S:CONFIG_MVEBU_MK6_SUPPORT=y
+CONFIG_MVEBU_THERMAL_SENSOR=y
+CONFIG_MVEBU_THERMAL_SENSOR_28NM_V2=y
-- 
1.9.1

