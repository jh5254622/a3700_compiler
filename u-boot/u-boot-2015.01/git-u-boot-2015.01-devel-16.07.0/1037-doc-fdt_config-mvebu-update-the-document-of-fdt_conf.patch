From 7cb74b5e44b39e6835b595a1aebbac6847add110 Mon Sep 17 00:00:00 2001
From: Nizan Zorea <nzorea@marvell.com>
Date: Thu, 18 Feb 2016 19:18:18 +0200
Subject: [PATCH 1037/1240] doc: fdt_config: mvebu: update the document of
 fdt_config command.

Change-Id: Ic0c920e3d1c9181684a03e0a2adab98c37c0a5a0
Signed-off-by: Nizan Zorea <nzorea@marvell.com>
Reviewed-on: http://vgitil04.il.marvell.com:8080/27663
Tested-by: Star_Automation <star@marvell.com>
Reviewed-by: Haim Boot <hayim@marvell.com>
---
 doc/mvebu/commands/fdt_config.txt | 90 +++++++++++++++------------------------
 1 file changed, 35 insertions(+), 55 deletions(-)

diff --git a/doc/mvebu/commands/fdt_config.txt b/doc/mvebu/commands/fdt_config.txt
index 8f93dde..04f64b2 100644
--- a/doc/mvebu/commands/fdt_config.txt
+++ b/doc/mvebu/commands/fdt_config.txt
@@ -11,88 +11,68 @@ and save it to EEPROM.
 
 Notes:
 ------
-1. To enable/disable the option to read FDT from the EEPROM set fdt_config to on/off accordingly.
-2. In order to use "fdt_config read" or "fdt_config select" first run the "fdt_config list" command.
-   The available <option_ids> are received from this list.
-3. All changes will be relevant only after running the save command ("fdt_config save") and resetting the board.
-4. The list of all the available configurations is located under "doc/mvebu/a8k/board_options"
-5. This feature reads the configuration from EEPROM, so before running it for the first time,
-   please erase EEPROM with command "i2c mw.l 0x57 0.2 0 0x200" to delete garbage data..
-   Please note:
+1. The list of all the available configurations is located under "doc/mvebu/a8k/board_options"
+2. This feature reads the configuration from EEPROM, so before running it for the first time,
+   Erase EEPROM with command "i2c mw.l 0x57 0.2 0 0x200" to delete garbage data..
+   Note:
    a) In the I2C erase command, 0x57 is the EEPROM address for A3700 DB; for other boards it would be different.
       Check the board spec for details.
    b) Erasing EEPROM is a temporary workaround. When this feature is more mature, it will handle the the garbage data
       in the EEPROM and so erasing will not be necessary.
 
-"fdt_config on" -   Enable the option to read the device tree from EEPROM at boot time.
-
-"fdt_config off" -  Disable the option to read the device tree from EEPROM at boot time.
-
-"fdt_config list" - Show the part of the device tree suitable for this board.
-                    print the list of <option_id> and fdt name for all the suitable FDTs.
-
-"fdt_config read flash <option_id>"
-		  - Read the <option_id> from user, and save the relevant device tree to DRAM using address 'fdt_addr' environment variable
-		    as default.
-		  Example:
-			$ fdt_config read flash 3
-			**Read the FDT with from flash (U-Boot image) with id=3 and save it to DRAM.
-			**Note: In order to read fdt from flash, run the "fdt_config list" command before.
-			        the <option_id> available are received from this list.
-"fdt_config read eeprom"
-		  - Read the device tree from the EEPROM and save it to DRAM using address 'fdt_addr' environment variable
-		    as default.
-		  Example:
-			$ fdt_config read eeprom
-
+"fdt_config list"
+		  - Show the part of the device tree suitable for this board.
+		  - Print the list of <option_id> and fdt name for all the suitable FDTs.
+		  - Print the customized fdt status (available/not available) in <option_id> = 0.
 "fdt_config select <option_id>"
-		  - Select the device tree from the flash for loading in the bootloader the next time.
-		    If the user wants to use this option its necessary to disable read FDT from EEPROM (by runnig "fdt_config off").
-		    **Note: To select fdt from flash first run "fdt_config list" command.
-			    Because the option_id is received from this list.
+		  - Select the device tree from the list for loading in the bootloader the next time.
+		  - To use the customized fdt from EEPROM, the customized fdt option needs to be
+		    available and then select <option_id> = 0.
+
+To create modified FDT on EEPROM, use the following:
+"fdt_config load <option_id>"
+		  - Load fdt <option_id> to DRAM (loaded to fdt_addr env. variable).
+		  - To read the device tree from the EEPROM and save it to DRAM select <option_id> = 0.
 
 "fdt_config save" - Write Device Tree changes from RAM to EEPROM.
 
 Example:
 ------
-   i) Select one of dtb files in the U-Boot image to boot with next time.
+    i) Select one of dtb files in the U-Boot image to boot with next time.
       a) List all the dtb files in the U-Boot image.
 	 Marvell>> fdt_config list
 	 FDT config list:
-	 1 - DB-88F3720-DDR3-Modular
-	 2 - DB-88F3720-DDR3-Modular-SGMII1
+		0 - (EPPROM) not available
+		1 - DB-88F3720-DDR3-Modular  [*]
+		2 - DB-88F3720-DDR3-Modular-SGMII1
       b) Select one of the dtb files to boot with next time.
 	 Marvell>> fdt_config select 2
-	 To save the changes, run the command fdt_config save.
-      c) Save the configuration.
-	 Marvell>> fdt_config save
-      d) Reset and U-Boot starts with the selected dtb file.
+      c) Reset and U-Boot starts with the selected dtb file.
 	 Marvell>> reset
    ii) Load certain dtb files from U-Boot image into DRAM and modify it.
        Burn it into EEPROM and boot with it.
-      a) Enable boot with dtb in EEPROM feature.
-	 Marvell>> fdt_config on
-	 Do you want to read FDT from EEPROM? <y/N> y
-	 Load fdt from EEprom
-	 To save the changes, run the command fdt_config save.
-      b) List all the dtb files in the U-Boot image.
+      a) List all the dtb files in the U-Boot image.
 	 Marvell>> fdt_config list
 	 FDT config list:
-	 1 - DB-88F3720-DDR3-Modular
-	 2 - DB-88F3720-DDR3-Modular-SGMII1
-      c) Load the dtb file into DRAM.
-	 Marvell>> fdt_config read flash 2
-	 To save the changes, run the command fdt_config save.
-      d) Run "fdt print" command to see the entire dtb file in DRAM.
-      e) Edit any property, for example, the preset value in the A3700 dts file.
+		0 - (EPPROM) not available
+		1 - DB-88F3720-DDR3-Modular
+		2 - DB-88F3720-DDR3-Modular-SGMII1  [*]
+      b) Load the dtb file into DRAM.
+	 Marvell>> fdt_config load 2
+	 To save the changes, please run the command fdt_config save.
+      c) Run "fdt print" command to see the entire dtb file in DRAM.
+      d) Edit any property, for example, the preset value in the A3700 dts file.
          Following are all the valid values for the property "preset":
 	 PRESET_CPU_600_DDR_600:  0
 	 PRESET_CPU_400_DDR_600:  1
 	 PRESET_CPU_1000_DDR_800: 2
 	 PRESET_CPU_800_DDR_800:  3
-
 	 Marvell>> fdt set /soc/freq preset "<1>"
-      f) Save the dtb file into EEPROM.
+      e) Save the dtb file into EEPROM.
 	 Marvell>> fdt_config save
+	 FDT is saved in EEPROM, to boot from customized FDT please select it from list
+      f) Select customized fdt from EEPROM (option 0 in the list), to boot from.
+	 Marvell>> fdt_config select 0
+	 Read FDT from EEPROM, please wait
       g) Reset and U-Boot starts with the dtb file in the EEPROM.
 	 Marvell>> reset
-- 
1.9.1

